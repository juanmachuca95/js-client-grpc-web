{"ast":null,"code":"import _toConsumableArray from \"/home/juan/node_projects/js-client-grpc-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/home/juan/node_projects/js-client-grpc-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/juan/node_projects/js-client-grpc-web/src/Subastas/JoinSubasta.js\";\nimport React, { useEffect, useState, useRef } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { Alert, Box, Button, Container, Grid, TextField, Typography } from '@mui/material';\nimport proto from '../pb/proto_grpc_web_pb';\nimport { makeStyles } from '@material-ui/core/styles';\nimport DataGridSubastaOfertas from '../components/DataGridTable';\nimport Layout from '../components/Layout/Layout';\nimport useToken from '../App/useToken';\nimport jwt_decode from 'jwt-decode';\nimport StepperVertical from '../components/StepperVertical';\nimport moment from 'moment';\n/** My Client gRPC - to Golang gRPC Server */\n\nvar subastaService = new proto.SubastaServiceClient('http://0.0.0.0:8000');\nexport default function JoinSubasta() {\n  var _useParams = useParams(),\n      id = _useParams.id;\n\n  var _useState = useState({}),\n      _useState2 = _slicedToArray(_useState, 2),\n      subasta = _useState2[0],\n      setSubasta = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      subastaProductos = _useState4[0],\n      setSubastaProductos = _useState4[1];\n\n  var _useState5 = useState(0),\n      _useState6 = _slicedToArray(_useState5, 2),\n      productoEnSubastaActual = _useState6[0],\n      setProductoEnSubastaActual = _useState6[1];\n\n  var _useState7 = useState(''),\n      _useState8 = _slicedToArray(_useState7, 2),\n      error_message = _useState8[0],\n      setErrorMessage = _useState8[1];\n\n  var _useState9 = useState(0),\n      _useState10 = _slicedToArray(_useState9, 2),\n      winnerOferta = _useState10[0],\n      setWinnerOferta = _useState10[1];\n\n  var useStyles = makeStyles({\n    bold: {\n      fontWeight: 600\n    }\n  });\n  var classes = useStyles();\n\n  var _useState11 = useState([]),\n      _useState12 = _slicedToArray(_useState11, 2),\n      rows = _useState12[0],\n      setRows = _useState12[1];\n\n  var _useState13 = useState(undefined),\n      _useState14 = _slicedToArray(_useState13, 2),\n      valSubastaOferta = _useState14[0],\n      setValSubastaOferta = _useState14[1];\n\n  var _useState15 = useState({}),\n      _useState16 = _slicedToArray(_useState15, 2),\n      user = _useState16[0],\n      setUser = _useState16[1];\n\n  var _useToken = useToken(),\n      token = _useToken.token;\n\n  var _useState17 = useState(0),\n      _useState18 = _slicedToArray(_useState17, 2),\n      duracion = _useState18[0],\n      setDuracion = _useState18[1];\n\n  var _useState19 = useState(\"\"),\n      _useState20 = _slicedToArray(_useState19, 2),\n      fecha = _useState20[0],\n      setFecha = _useState20[1];\n\n  var _useState21 = useState(\"00\"),\n      _useState22 = _slicedToArray(_useState21, 2),\n      day = _useState22[0],\n      setDay = _useState22[1];\n\n  var _useState23 = useState(\"00\"),\n      _useState24 = _slicedToArray(_useState23, 2),\n      hour = _useState24[0],\n      setHour = _useState24[1];\n\n  var _useState25 = useState(\"00\"),\n      _useState26 = _slicedToArray(_useState25, 2),\n      second = _useState26[0],\n      setSecond = _useState26[1];\n\n  var _useState27 = useState(\"00\"),\n      _useState28 = _slicedToArray(_useState27, 2),\n      minute = _useState28[0],\n      setMinute = _useState28[1];\n\n  var _useState29 = useState(false),\n      _useState30 = _slicedToArray(_useState29, 2),\n      startCount = _useState30[0],\n      setStartCount = _useState30[1];\n\n  var _useState31 = useState(false),\n      _useState32 = _slicedToArray(_useState31, 2),\n      subastaFinalizada = _useState32[0],\n      setSubastaFinalizada = _useState32[1];\n\n  useEffect(function () {\n    /** The Subasta */\n    getSubasta();\n    /** Products from subasta */\n\n    getSubastaProductos();\n    /** Ofertas */\n\n    getSubastaOfertas();\n    /** Set Data for User */\n\n    getUser();\n  }, []);\n  useEffect(function () {\n    if (subasta.fecha && subasta.duracion) {\n      setTimeOver();\n    }\n  }, [subasta.fecha, subasta.duracion]); // Se ejecuta cuando la variable fecha esta lista\n\n  useEffect(function () {\n    if (startCount) {\n      console.log(\"Comenzar la cuenta regresiva\");\n      var duration = moment.duration({\n        'minutes': subasta.duracion,\n        'seconds': 0\n      });\n      var eventDay = moment(subasta.fecha);\n      eventDay.add(subasta.duracion, 'minutes');\n      var timestamp = new Date(eventDay);\n      var interval = 1;\n      var timer = setInterval(function () {\n        timestamp = new Date(timestamp.getTime() + interval * 1000);\n        console.log(timestamp);\n        duration = moment.duration(duration.asSeconds() - interval, 'seconds');\n        var min = duration.minutes();\n        var sec = duration.seconds();\n        sec -= 1;\n        if (min < 0) return clearInterval(timer);\n        if (min < 10 && min.length != 2) min = '0' + min;\n\n        if (sec < 0 && min != 0) {\n          min -= 1;\n          sec = 59;\n        } else if (sec < 10 && sec.length != 2) sec = '0' + sec;\n\n        setSecond(sec);\n        setMinute(min);\n\n        if (min == 0 && sec == 0) {\n          clearInterval(timer);\n          setStartCount(false);\n        }\n      }, 1000);\n    }\n  }, [startCount]);\n\n  var setTimeOver = function setTimeOver() {\n    var fecha = new Date(subasta.fecha);\n    var actual = new Date();\n\n    if (actual < fecha) {\n      fecha = \"ComenzarÃ¡ el \" + fecha.toLocaleDateString(\"es\", {\n        weekday: 'long',\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      });\n      setFecha(fecha);\n      return;\n    }\n\n    if (actual.getTime() == fecha.getTime()) {\n      fecha = \"La subasta se realiza hoy a las \" + fecha.getHours() + \":\" + fecha.getMinutes();\n      setFecha(fecha);\n      return;\n    }\n\n    if (actual > fecha && !subastaFinalizada) {\n      fecha = \"La subasta comenzado a las \" + fecha.getHours() + \":\" + fecha.getMinutes();\n      setFecha(fecha);\n      setStartCount(true);\n      return;\n    }\n  };\n\n  var getUser = function getUser() {\n    console.log(\"token. . . .\", token);\n    var token_decoded = jwt_decode(token);\n    var user = {\n      users_id: token_decoded.users_id,\n      name: token_decoded.name,\n      photo: token_decoded.profile_photo_path\n    };\n    setUser(user);\n  };\n\n  var getSubastaOfertas = function getSubastaOfertas() {\n    console.log(\"Obteniendo subastas ofertas -- from server golang\");\n    var request = new proto.SubastaProductoId();\n    request.setId(productoEnSubastaActual.id);\n    var stream = subastaService.getSubastaOfertas(request, {});\n    stream.on('data', function (response) {\n      var record = {\n        user: response.getUser(),\n        oferta: response.getOfertaPrecio()\n      };\n\n      if (record.oferta > winnerOferta) {\n        setWinnerOferta(record.oferta);\n      }\n\n      setRows(function (rows) {\n        return [].concat(_toConsumableArray(rows), [record]);\n      });\n    });\n  };\n\n  function getSubasta() {\n    var request = new proto.SubastaId();\n    request.setId(id);\n    var metadata = {};\n    subastaService.getSubasta(request, metadata, function (err, response) {\n      if (err) {\n        console.log(err.code, err.message);\n      } else {\n        var _subasta = {\n          id: response.getId(),\n          subasta: response.getSubasta(),\n          fecha: response.getFecha(),\n          activo: response.getActivo(),\n          duracion: response.getDuracion(),\n          created_at: response.getCreatedAt(),\n          updated_at: response.getUpdatedAt()\n        };\n        setSubasta(_subasta);\n      }\n    });\n  }\n\n  var getSubastaProductos = function getSubastaProductos() {\n    var request = new proto.SubastaId();\n    request.setId(id);\n    var metadata = {};\n    subastaService.getSubastaProductos(request, metadata, function (err, response) {\n      if (err) {\n        console.log(err.code, err.message);\n      } else {\n        var subastaProductosList = response.getSubastasProductosList();\n        subastaProductosList = subastaProductosList.map(function (subastaProducto) {\n          return {\n            id: subastaProducto.array[0],\n            producto: {\n              productos_id: subastaProducto.array[1][0],\n              producto: subastaProducto.array[1][1],\n              descripcion: subastaProducto.array[1][2],\n              stock: subastaProducto.array[1][3],\n              precio_inicial: subastaProducto.array[1][4],\n              precio_aumento: subastaProducto.array[1][5],\n              precio_subasta: subastaProducto.array[1][6],\n              cliente: {\n                cliente_id: subastaProducto.array[1][7][0],\n                cliente: subastaProducto.array[1][7][1],\n                cuit: subastaProducto.array[1][7][2],\n                direccion: subastaProducto.array[1][7][3],\n                ciudad: subastaProducto.array[1][7][4],\n                iva: subastaProducto.array[1][7][5]\n              }\n            }\n          };\n        });\n        setSubastaProductos(subastaProductosList);\n        setProductoEnSubastaActual(subastaProductosList[0].producto); // producto en subasta\n      }\n    });\n  };\n\n  var handlerCreateSubastaOferta = function handlerCreateSubastaOferta(e) {\n    e.preventDefault();\n\n    if (!(valSubastaOferta !== \"\" && valSubastaOferta > productoEnSubastaActual.precio_inicial)) {\n      setErrorMessage('El valor de oferta de ser superior o igual al precio inicial.');\n      return;\n    }\n\n    var ofertaGanadora = 0;\n\n    if (winnerOferta === 0) {\n      ofertaGanadora = productoEnSubastaActual.precio_inicial;\n    } else {\n      ofertaGanadora = winnerOferta;\n    }\n\n    ;\n    console.log(winnerOferta, productoEnSubastaActual.precio_inicial, ofertaGanadora + productoEnSubastaActual.precio_aumento);\n\n    if (!(valSubastaOferta >= ofertaGanadora + productoEnSubastaActual.precio_aumento)) {\n      setErrorMessage('El valor de oferta de ser superior o igual al precio ganador + el precio de aumento del producto.');\n      return;\n    }\n\n    var subastaOfertaCreate = new proto.SubastaOfertaCreate();\n    subastaOfertaCreate.setUsersId(user.users_id);\n    subastaOfertaCreate.setOfertaPrecio(valSubastaOferta);\n    subastaOfertaCreate.setSubastasProductosId(1);\n    subastaService.addSubastaOferta(subastaOfertaCreate, {}, function (error, _) {\n      if (error !== null) console.log(error.code, error.message);\n    });\n    setValSubastaOferta(undefined);\n    document.getElementById('valSubastaOferta').value = '';\n  };\n\n  return /*#__PURE__*/React.createElement(Layout, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    sx: {\n      paddingTop: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 5,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 5,\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    style: {\n      paddingBottom: '20px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"h1\",\n    fontSize: 40,\n    className: classes.bold,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 33\n    }\n  }, subasta.subasta), /*#__PURE__*/React.createElement(Typography, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 33\n    }\n  }, \"Producto en subasta - \", productoEnSubastaActual.producto, /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 93\n    }\n  }), \"Unidades - \", productoEnSubastaActual.stock, \" \", /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 80\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 29\n    }\n  }, winnerOferta > 0 && /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(Alert, {\n    variant: \"outlined\",\n    severity: \"success\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 37\n    }\n  }, \"Oferta ganadora: \", winnerOferta)), error_message !== '' && /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(Alert, {\n    severity: \"error\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 37\n    }\n  }, error_message)), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 8,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    inputProps: {\n      inputMode: 'numeric',\n      pattern: '[0-9]*'\n    },\n    style: {\n      height: '38px'\n    },\n    id: \"valSubastaOferta\",\n    onChange: function onChange(e) {\n      return setValSubastaOferta(e.target.value);\n    },\n    fullWidth: true,\n    label: \"Ofertar\",\n    variant: \"outlined\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 37\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: handlerCreateSubastaOferta,\n    fullWidth: true,\n    variant: \"outlined\",\n    size: \"large\"\n    /* style={{ paddingTop: '13px', paddingBottom: '13px' }} */\n    ,\n    style: {\n      padding: '14px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 37\n    }\n  }, \"Ofertar\"))), /*#__PURE__*/React.createElement(DataGridSubastaOfertas, {\n    rows: rows,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 29\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 7,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 314,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    style: {\n      paddingBottom: '40px',\n      paddingTop: '20px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    align: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 317,\n      columnNumber: 33\n    }\n  }, fecha), startCount && /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      width: '100%'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    padding: 2,\n    sx: {\n      borderRadius: 1,\n      backgroundColor: '#e6e6e6',\n      margin: 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 37\n    }\n  }, minute), /*#__PURE__*/React.createElement(Box, {\n    padding: 2,\n    sx: {\n      borderRadius: 1,\n      backgroundColor: '#e6e6e6',\n      margin: 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 327,\n      columnNumber: 37\n    }\n  }, second))), /*#__PURE__*/React.createElement(StepperVertical, {\n    steps: subastaProductos,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 334,\n      columnNumber: 29\n    }\n  }))))));\n}","map":{"version":3,"sources":["/home/juan/node_projects/js-client-grpc-web/src/Subastas/JoinSubasta.js"],"names":["React","useEffect","useState","useRef","useParams","Alert","Box","Button","Container","Grid","TextField","Typography","proto","makeStyles","DataGridSubastaOfertas","Layout","useToken","jwt_decode","StepperVertical","moment","subastaService","SubastaServiceClient","JoinSubasta","id","subasta","setSubasta","subastaProductos","setSubastaProductos","productoEnSubastaActual","setProductoEnSubastaActual","error_message","setErrorMessage","winnerOferta","setWinnerOferta","useStyles","bold","fontWeight","classes","rows","setRows","undefined","valSubastaOferta","setValSubastaOferta","user","setUser","token","duracion","setDuracion","fecha","setFecha","day","setDay","hour","setHour","second","setSecond","minute","setMinute","startCount","setStartCount","subastaFinalizada","setSubastaFinalizada","getSubasta","getSubastaProductos","getSubastaOfertas","getUser","setTimeOver","console","log","duration","eventDay","add","timestamp","Date","interval","timer","setInterval","getTime","asSeconds","min","minutes","sec","seconds","clearInterval","length","actual","toLocaleDateString","weekday","year","month","getHours","getMinutes","token_decoded","users_id","name","photo","profile_photo_path","request","SubastaProductoId","setId","stream","on","response","record","oferta","getOfertaPrecio","SubastaId","metadata","err","code","message","getId","getFecha","activo","getActivo","getDuracion","created_at","getCreatedAt","updated_at","getUpdatedAt","subastaProductosList","getSubastasProductosList","map","subastaProducto","array","producto","productos_id","descripcion","stock","precio_inicial","precio_aumento","precio_subasta","cliente","cliente_id","cuit","direccion","ciudad","iva","handlerCreateSubastaOferta","e","preventDefault","ofertaGanadora","subastaOfertaCreate","SubastaOfertaCreate","setUsersId","setOfertaPrecio","setSubastasProductosId","addSubastaOferta","error","_","document","getElementById","value","paddingTop","paddingBottom","inputMode","pattern","height","target","padding","display","justifyContent","width","borderRadius","backgroundColor","margin"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react'\nimport { useParams } from 'react-router-dom'\nimport { Alert, Box, Button, Container, Grid, TextField, Typography } from '@mui/material';\nimport proto from '../pb/proto_grpc_web_pb';\nimport { makeStyles } from '@material-ui/core/styles';\nimport DataGridSubastaOfertas from '../components/DataGridTable';\nimport Layout from '../components/Layout/Layout';\nimport useToken from '../App/useToken';\nimport jwt_decode from 'jwt-decode';\nimport StepperVertical from '../components/StepperVertical';\nimport moment from 'moment';\n\n\n/** My Client gRPC - to Golang gRPC Server */\nvar subastaService = new proto.SubastaServiceClient('http://0.0.0.0:8000');\n\n\nexport default function JoinSubasta(){\n    const { id } = useParams();\n    const [subasta, setSubasta] = useState({});\n    const [subastaProductos, setSubastaProductos] = useState([]);\n    const [productoEnSubastaActual, setProductoEnSubastaActual] = useState(0);\n    const [error_message, setErrorMessage] = useState('')\n    const [winnerOferta, setWinnerOferta] = useState(0)\n    const useStyles = makeStyles({bold: {fontWeight: 600}})\n    const classes = useStyles();\n    const [rows, setRows] = useState([]);\n    const [valSubastaOferta, setValSubastaOferta] = useState(undefined);\n    const [user, setUser] = useState({});\n    const { token } = useToken();\n    const [duracion, setDuracion] = useState(0);\n    const [fecha, setFecha] = useState(\"\");\n    const [day, setDay] = useState(\"00\");\n    const [hour, setHour] = useState(\"00\");\n    const [second, setSecond] = useState(\"00\");\n    const [minute, setMinute] = useState(\"00\");\n    const [startCount, setStartCount] = useState(false);\n    const [subastaFinalizada, setSubastaFinalizada] = useState(false);\n\n    useEffect(() => {\n        /** The Subasta */\n        getSubasta();\n\n        /** Products from subasta */\n        getSubastaProductos();\n\n        /** Ofertas */\n        getSubastaOfertas();\n\n        /** Set Data for User */\n        getUser();\n    }, [])\n\n\n    useEffect(() => {\n        if(subasta.fecha && subasta.duracion){\n            setTimeOver();\n        }\n    }, [subasta.fecha, subasta.duracion]) // Se ejecuta cuando la variable fecha esta lista\n\n\n    useEffect(() => {\n        if(startCount){\n            console.log(\"Comenzar la cuenta regresiva\");\n\n            var duration = moment.duration({\n                'minutes': subasta.duracion,\n                'seconds': 0  \n            });\n            \n            let eventDay = moment(subasta.fecha);\n            eventDay.add(subasta.duracion, 'minutes');\n\n            var timestamp = new Date(eventDay);\n            var interval = 1;\n            var timer = setInterval(function() {\n                timestamp = new Date(timestamp.getTime() + interval * 1000);\n                console.log(timestamp)\n                duration = moment.duration(duration.asSeconds() - interval, 'seconds');\n                var min = duration.minutes();\n                var sec = duration.seconds();\n\n                sec -= 1;\n                if (min < 0) return clearInterval(timer);\n                if (min < 10 && min.length != 2) min = '0' + min;\n                if (sec < 0 && min != 0) {\n                    min -= 1;\n                    sec = 59;\n                } else if (sec < 10 && sec.length != 2) sec = '0' + sec;\n                setSecond(sec);\n                setMinute(min);\n                if (min == 0 && sec == 0){\n                    clearInterval(timer);\n                    setStartCount(false);\n                }\n\n            }, 1000);\n        }\n\n    }, [startCount])\n\n    const setTimeOver = () => {\n        let fecha = new Date(subasta.fecha)\n        let actual = new Date();\n        if(actual < fecha){\n            fecha = \"ComenzarÃ¡ el \"+ fecha.toLocaleDateString(\"es\", { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });\n            setFecha(fecha);\n            return ;\n        }\n\n        if(actual.getTime() == fecha.getTime()){\n            fecha = \"La subasta se realiza hoy a las \"+ fecha.getHours()+\":\"+fecha.getMinutes();\n            setFecha(fecha)\n            return ;\n        }\n\n        if(actual > fecha && !subastaFinalizada){\n            fecha = \"La subasta comenzado a las \"+ fecha.getHours()+\":\"+fecha.getMinutes();\n            setFecha(fecha)\n\n            setStartCount(true);\n            return ;\n        }\n    }\n\n\n    const getUser = () => {\n        console.log(\"token. . . .\", token)\n        var token_decoded = jwt_decode(token);\n        let user = {\n            users_id: token_decoded.users_id,\n            name: token_decoded.name,\n            photo: token_decoded.profile_photo_path,\n        }\n        setUser(user);\n    }\n\n    const getSubastaOfertas = () => {\n        console.log(\"Obteniendo subastas ofertas -- from server golang\")\n    \n        let request = new proto.SubastaProductoId();\n        request.setId(productoEnSubastaActual.id)\n        var stream = subastaService.getSubastaOfertas(request, {});\n\n        stream.on('data', function(response){\n            let record = {\n                user: response.getUser(),\n                oferta: response.getOfertaPrecio()\n            };   \n\n            if(record.oferta > winnerOferta){\n                setWinnerOferta(record.oferta)\n            }\n\n            setRows((rows) => [...rows, record])\n        })\n\n    };\n\n    function getSubasta() {\n        var request = new proto.SubastaId();\n        request.setId(id)\n        var metadata = {};\n    \n        subastaService.getSubasta(request, metadata, (err, response) => {\n            if (err) {\n                console.log(err.code, err.message);\n            } else {\n                let subasta = {\n                    id: response.getId(),\n                    subasta: response.getSubasta(),\n                    fecha: response.getFecha(),\n                    activo: response.getActivo(),\n                    duracion: response.getDuracion(),\n                    created_at: response.getCreatedAt(),\n                    updated_at: response.getUpdatedAt()\n                }\n                setSubasta(subasta);\n            }\n        });\n    }\n\n    const getSubastaProductos = () => {\n        var request = new proto.SubastaId()\n        request.setId(id)\n        var metadata = {}\n\n        subastaService.getSubastaProductos(request, metadata, (err, response) => {\n            if(err){\n                console.log(err.code, err.message)\n            }else{\n                let subastaProductosList = response.getSubastasProductosList();\n                subastaProductosList = subastaProductosList\n                    .map((subastaProducto) => {\n                        return {\n                            id: subastaProducto.array[0],\n                            producto: {\n                                productos_id: subastaProducto.array[1][0],\n                                producto: subastaProducto.array[1][1],\n                                descripcion: subastaProducto.array[1][2],\n                                stock: subastaProducto.array[1][3],\n                                precio_inicial: subastaProducto.array[1][4],\n                                precio_aumento: subastaProducto.array[1][5],\n                                precio_subasta: subastaProducto.array[1][6],\n                                cliente: {\n                                    cliente_id: subastaProducto.array[1][7][0],\n                                    cliente: subastaProducto.array[1][7][1],\n                                    cuit: subastaProducto.array[1][7][2],\n                                    direccion: subastaProducto.array[1][7][3],\n                                    ciudad: subastaProducto.array[1][7][4],\n                                    iva: subastaProducto.array[1][7][5],\n                                }\n                            }\n                        }\n                    })\n\n                setSubastaProductos(subastaProductosList);\n                setProductoEnSubastaActual(subastaProductosList[0].producto) // producto en subasta\n            }\n        });\n    }\n\n\n    const handlerCreateSubastaOferta = (e) => {\n        e.preventDefault();\n\n        if(!(valSubastaOferta !== \"\" && valSubastaOferta > productoEnSubastaActual.precio_inicial)) {\n            setErrorMessage('El valor de oferta de ser superior o igual al precio inicial.');\n            return ;\n        }\n\n        var ofertaGanadora = 0;\n        if(winnerOferta === 0) {\n            ofertaGanadora = productoEnSubastaActual.precio_inicial} \n        else {\n            ofertaGanadora = winnerOferta;\n        };\n        console.log(winnerOferta, productoEnSubastaActual.precio_inicial, ofertaGanadora+productoEnSubastaActual.precio_aumento)\n        if(!(valSubastaOferta >= (ofertaGanadora+productoEnSubastaActual.precio_aumento))){\n            setErrorMessage('El valor de oferta de ser superior o igual al precio ganador + el precio de aumento del producto.');\n            return ;\n        } \n\n        let subastaOfertaCreate = new proto.SubastaOfertaCreate();\n        subastaOfertaCreate.setUsersId(user.users_id);\n        subastaOfertaCreate.setOfertaPrecio(valSubastaOferta);\n        subastaOfertaCreate.setSubastasProductosId(1);\n\n        subastaService.addSubastaOferta(subastaOfertaCreate, {}, (error, _) => {\n            if(error !== null) console.log(error.code, error.message);\n        });\n\n        setValSubastaOferta(undefined)\n        document.getElementById('valSubastaOferta').value = '';\n    }\n\n    return (\n        <Layout>\n            <Box sx={{ paddingTop: 8 }}>\n                <Container>\n                    <Grid container spacing={5}>\n                        <Grid item xs={5} align=\"left\">      \n                            <Box style={{ paddingBottom: '20px' }}>\n                                <Typography variant=\"h1\" fontSize={40} className={classes.bold}>\n                                    {subasta.subasta}\n                                </Typography>        \n                                <Typography>\n                                    Producto en subasta - {productoEnSubastaActual.producto}<br></br>  \n                                    Unidades - {productoEnSubastaActual.stock} <br></br>\n                                </Typography>    \n                            </Box>\n\n                            <Grid container>   \n                                {winnerOferta > 0 &&\n                                <Grid item xs={12}>\n                                    <Alert  variant=\"outlined\" severity=\"success\">\n                                        Oferta ganadora: { winnerOferta }\n                                    </Alert>\n                                </Grid>\n                                }\n\n\n                                {error_message !== '' &&\n                                <Grid item xs={12}> \n                                    <Alert severity=\"error\">{ error_message }</Alert>  \n                                </Grid>                            \n                                }\n                                <Grid item xs={8}>\n                                    <TextField \n                                        inputProps={{ inputMode: 'numeric', pattern: '[0-9]*'  }}\n                                        style={{ height:'38px' }}\n                                        id=\"valSubastaOferta\" \n                                        onChange={(e) => setValSubastaOferta(e.target.value)} \n                                        fullWidth \n                                        label=\"Ofertar\" \n                                        variant=\"outlined\" \n                                    />\n                                </Grid>\n                                <Grid item xs={4}>\n                                    <Button onClick={handlerCreateSubastaOferta} fullWidth variant=\"outlined\" size=\"large\" \n                                        /* style={{ paddingTop: '13px', paddingBottom: '13px' }} */\n                                        style={{ padding:'14px' }}\n                                    >\n                                        Ofertar\n                                    </Button>\n                                </Grid>\n                            </Grid>\n\n                            {/* <DataTableSubastaOfertas rows={rows} /> */}\n                            <DataGridSubastaOfertas rows={rows} />\n                            \n                        </Grid>\n\n                        <Grid item xs={7}>  \n                                \n                            <Box style={{ paddingBottom: '40px', paddingTop: '20px' }}>\n                                <Typography align='center'>\n                                    {fecha} \n                                </Typography>\n                                \n                                {startCount && \n                                <div style={{ display:'flex', justifyContent:'center', width:'100%' }}>\n                                    <Box padding={2} sx={{ borderRadius: 1, backgroundColor: '#e6e6e6', margin: 1 }}>\n                                        {minute}\n                                    </Box>\n                                \n                                    <Box padding={2} sx={{ borderRadius: 1, backgroundColor: '#e6e6e6', margin: 1 }}>\n                                        {second}\n                                    </Box>\n                                </div>}\n\n                            </Box>\n\n                            <StepperVertical steps={subastaProductos}/>\n                            {/*  <StepperListSubastaProductos subastaProductos={subastaProductos}/> */}\n                        </Grid>\n                    </Grid>\n\n                         \n                </Container>\n            </Box>\n        </Layout>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}