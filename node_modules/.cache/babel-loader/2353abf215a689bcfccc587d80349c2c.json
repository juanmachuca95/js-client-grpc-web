{"ast":null,"code":"import _toConsumableArray from \"/home/juan/node_projects/js-client-grpc-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/home/juan/node_projects/js-client-grpc-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/juan/node_projects/js-client-grpc-web/src/Subastas/JoinSubasta.js\";\nimport React, { useEffect, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { Alert, Box, Button, Container, Grid, TextField, Typography } from '@mui/material';\nimport proto from '../pb/proto_grpc_web_pb';\nimport DataGridSubastaOfertas from '../components/DataGridTable';\nimport Layout from '../components/Layout/Layout';\nimport useToken from '../App/useToken';\nimport jwt_decode from 'jwt-decode';\nimport StepperVertical from '../components/StepperVertical';\nimport moment from 'moment';\n/** My Client gRPC - to Golang gRPC Server */\n\nvar subastaService = new proto.SubastaServiceClient('http://0.0.0.0:8000');\nexport default function JoinSubasta() {\n  var _useParams = useParams(),\n      id = _useParams.id;\n  /** Info Subasta */\n\n\n  var _useState = useState({}),\n      _useState2 = _slicedToArray(_useState, 2),\n      subasta = _useState2[0],\n      setSubasta = _useState2[1];\n  /** Lista de productos en subasta */\n\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      subastaProductos = _useState4[0],\n      setSubastaProductos = _useState4[1];\n  /** Producto actual en Subasta */\n\n\n  var _useState5 = useState(0),\n      _useState6 = _slicedToArray(_useState5, 2),\n      productoEnSubastaActual = _useState6[0],\n      setProductoEnSubastaActual = _useState6[1];\n  /** Producto subasta */\n\n\n  var _useState7 = useState(0),\n      _useState8 = _slicedToArray(_useState7, 2),\n      subastaProductoActual = _useState8[0],\n      setSubastaProductoActual = _useState8[1];\n  /** Set Precio de oferta */\n\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      winnerOferta = _useState10[0],\n      setWinnerOferta = _useState10[1];\n  /** Error form add oferta */\n\n\n  var _useState11 = useState(''),\n      _useState12 = _slicedToArray(_useState11, 2),\n      error_message = _useState12[0],\n      setErrorMessage = _useState12[1];\n\n  var _useState13 = useState([]),\n      _useState14 = _slicedToArray(_useState13, 2),\n      rows = _useState14[0],\n      setRows = _useState14[1];\n\n  var _useState15 = useState(undefined),\n      _useState16 = _slicedToArray(_useState15, 2),\n      valSubastaOferta = _useState16[0],\n      setValSubastaOferta = _useState16[1];\n\n  var _useState17 = useState({}),\n      _useState18 = _slicedToArray(_useState17, 2),\n      user = _useState18[0],\n      setUser = _useState18[1];\n\n  var _useToken = useToken(),\n      token = _useToken.token;\n\n  var _useState19 = useState(\"\"),\n      _useState20 = _slicedToArray(_useState19, 2),\n      fecha = _useState20[0],\n      setFecha = _useState20[1];\n\n  var _useState21 = useState(\"00\"),\n      _useState22 = _slicedToArray(_useState21, 2),\n      second = _useState22[0],\n      setSecond = _useState22[1];\n\n  var _useState23 = useState(\"00\"),\n      _useState24 = _slicedToArray(_useState23, 2),\n      minute = _useState24[0],\n      setMinute = _useState24[1];\n\n  var _useState25 = useState(false),\n      _useState26 = _slicedToArray(_useState25, 2),\n      startCount = _useState26[0],\n      setStartCount = _useState26[1];\n\n  var _useState27 = useState(false),\n      _useState28 = _slicedToArray(_useState27, 2),\n      subastaFinalizada = _useState28[0],\n      setSubastaFinalizada = _useState28[1];\n  /** Controles de tiempo */\n\n\n  var _useState29 = useState(),\n      _useState30 = _slicedToArray(_useState29, 2),\n      inicio = _useState30[0],\n      setInicio = _useState30[1];\n\n  var _useState31 = useState(),\n      _useState32 = _slicedToArray(_useState31, 2),\n      fin = _useState32[0],\n      setFin = _useState32[1];\n\n  useEffect(function () {\n    /** The Subasta */\n    getSubasta();\n    /** Ofertas */\n    //getSubastaOfertas();\n\n    /** Set Data for User */\n\n    getUser();\n    getTest();\n  }, []);\n  useEffect(function () {\n    /** Products from subasta */\n    if (subasta.id) {\n      console.log(\"cargar\", subasta.id);\n      getSubastaProductos();\n    }\n  }, [subasta.id]);\n\n  var getTest = function getTest() {\n    var fecha1 = moment(\"2022-04-07 09:30:00\");\n    var fecha2 = moment(\"2022-04-07 09:30:00\");\n    /*   \n    console.log(\"fecha1: \", fecha1);\n    console.log(\"fecha2: \", fecha2);\n     console.log(fecha2.diff(fecha1, 'minutes'), \"diferencia en minutos\");\n    \n     console.log(\"Se agrego 10 minutos a la fecha 2\");\n    fecha2.add(10, 'minute');\n    console.log(fecha2.diff(fecha1, 'minutes'), \"diferencia en minutos\");\n     */\n  };\n  /** Hacer generica la funcion para reutilizarla en el proximo producto */\n\n\n  useEffect(function () {\n    if (subasta.fecha && subasta.duracion) {\n      var interval = setInterval(function () {\n        var _fecha = moment(subasta.fecha);\n\n        var actual = moment();\n        var tiempo_maximo = moment(subasta.fecha);\n        tiempo_maximo.add(subasta.duracion, 'minute');\n        var diferencia_tiempo_maximo = actual.diff(tiempo_maximo, 'minute');\n        var diferencia_t_m_seconds = actual.diff(tiempo_maximo, 'second');\n\n        if (actual > tiempo_maximo) {\n          // Llego tarde.\n          var _fecha2 = \"Ya ha finalizado este fragmento de subasta . . . \";\n          setFecha(_fecha2);\n          setStartCount(false);\n          clearInterval(interval);\n          return;\n        }\n\n        if (diferencia_tiempo_maximo == 0 && diferencia_t_m_seconds == 0) {\n          // quedo no tocar\n          var _fecha3 = \"El tiempo de subasta de este producto ha terminado . . . \";\n          setFecha(_fecha3);\n          setStartCount(false);\n          clearInterval(interval);\n          return;\n        }\n\n        console.log(\"mostrar restante: minutos \", diferencia_tiempo_maximo, \" segundos \", diferencia_t_m_seconds);\n\n        if (diferencia_tiempo_maximo < 0 && diferencia_t_m_seconds < 0) {\n          var segundos = 0;\n\n          if (diferencia_tiempo_maximo * -1 !== 0) {\n            segundos = diferencia_t_m_seconds * -1 - diferencia_tiempo_maximo * -1 * 60;\n          } else {\n            segundos = diferencia_t_m_seconds * -1;\n          }\n\n          var min = diferencia_tiempo_maximo * -1;\n          setMinute(min);\n          setSecond(segundos);\n\n          var _fecha4 = \"Restan \" + min + \" minutos \" + segundos + \" segundos.\";\n\n          setFecha(_fecha4);\n        }\n\n        var diferencia = _fecha.diff(actual, 'minute');\n\n        var dif_seconds = _fecha.diff(actual, 'second');\n\n        console.log(\"loop diferencia minutos: \", diferencia, \" segundos: \", dif_seconds);\n        console.log(\"estatus \", subastaProductoActual);\n\n        if (diferencia == 0 && dif_seconds == 0) {\n          console.log(\"hola\", diferencia);\n          var request = new proto.SubastaProductoId();\n          request.setId(productoEnSubastaActual.productos_id);\n          subastaService.setProductoEnSubasta(request, {}, function (error, _) {\n            if (error) {\n              setErrorMessage(error.code + \" \" + error.message);\n              setStartCount(false);\n              return;\n            }\n            /* subastaProductoActual.status = \"en subasta\";\n            setSubastaProductoActual(subastaProductoActual); */\n\n\n            setStartCount(true);\n          });\n          var _fecha5 = \"Ha comenzado la subasta . . .\";\n          setFecha(_fecha5);\n          return;\n        }\n\n        if (diferencia >= 0 && dif_seconds > 0) {\n          // quedo ! no tocar\n          var _fecha6 = \"ComenzarÃ¡ en \" + diferencia + \" minutos \" + (dif_seconds - diferencia * 60) + \" segundos.\";\n\n          setFecha(_fecha6);\n        }\n      }, 1000);\n    }\n  }, [subasta.fecha, subasta.duracion]); // Se ejecuta cuando la variable fecha esta lista\n\n  useEffect(function () {\n    if (startCount) {\n      var pSubastaInicio = moment(subasta.fecha);\n      var pSubastaFin = moment(subasta.fecha);\n      pSubastaFin.add(subasta.duracion, 'minute');\n      var interval = setInterval(function () {\n        console.log(\"_____ itera ??? \");\n        var diferencia = pSubastaFin.diff(pSubastaInicio, 'minutes');\n\n        if (diferencia === 0) {\n          setStartCount(false);\n          setFecha(\"Subasta producto \" + productoEnSubastaActual.producto + \" ha finalizado\");\n          clearInterval(interval);\n        }\n      }, 1000);\n    }\n  }, [startCount]);\n\n  var getUser = function getUser() {\n    var token_decoded = jwt_decode(token);\n    var user = {\n      users_id: token_decoded.users_id,\n      name: token_decoded.name,\n      photo: token_decoded.profile_photo_path\n    };\n    setUser(user);\n  };\n\n  var getSubastaOfertas = function getSubastaOfertas() {\n    console.log(\"Obteniendo subastas ofertas -- from server golang\");\n    var request = new proto.SubastaProductoId();\n    request.setId(productoEnSubastaActual.id);\n    var stream = subastaService.getSubastaOfertas(request, {});\n    stream.on('data', function (response) {\n      var record = {\n        user: response.getUser(),\n        oferta: response.getOfertaPrecio()\n      };\n\n      if (record.oferta > winnerOferta) {\n        setWinnerOferta(record.oferta);\n      }\n\n      setRows(function (rows) {\n        return [].concat(_toConsumableArray(rows), [record]);\n      });\n    });\n  };\n\n  function getSubasta() {\n    var request = new proto.SubastaId();\n    request.setId(id);\n    var metadata = {};\n    subastaService.getSubasta(request, metadata, function (err, response) {\n      if (err) {\n        console.log(err.code, err.message);\n      } else {\n        var _subasta = {\n          id: response.getId(),\n          subasta: response.getSubasta(),\n          fecha: response.getFecha(),\n          activo: response.getActivo(),\n          duracion: response.getDuracion(),\n          created_at: response.getCreatedAt(),\n          updated_at: response.getUpdatedAt()\n        };\n        setSubasta(_subasta);\n      }\n    });\n  }\n\n  var getSubastaProductos = function getSubastaProductos() {\n    var request = new proto.SubastaId();\n    var id = subasta.id;\n    request.setId(id);\n    var metadata = {};\n    subastaService.getSubastaProductos(request, metadata, function (err, response) {\n      if (err) {\n        console.log(err.code, err.message);\n      } else {\n        var subastaProductosList = response.getSubastasProductosList();\n        subastaProductosList = subastaProductosList.map(function (subastaProducto) {\n          return {\n            id: subastaProducto.array[0],\n            producto: {\n              productos_id: subastaProducto.array[1][0],\n              producto: subastaProducto.array[1][1],\n              descripcion: subastaProducto.array[1][2],\n              stock: subastaProducto.array[1][3],\n              precio_inicial: subastaProducto.array[1][4],\n              precio_aumento: subastaProducto.array[1][5],\n              precio_subasta: subastaProducto.array[1][6],\n              cliente: {\n                cliente_id: subastaProducto.array[1][7][0],\n                cliente: subastaProducto.array[1][7][1],\n                cuit: subastaProducto.array[1][7][2],\n                direccion: subastaProducto.array[1][7][3],\n                ciudad: subastaProducto.array[1][7][4],\n                iva: subastaProducto.array[1][7][5]\n              }\n            },\n            activo: subastaProducto.array[2],\n            oferta_final: subastaProducto.array[3],\n            subastas_ofertas_id_winner: subastaProducto.array[4],\n            status: subastaProducto.array[5]\n          };\n        });\n        setSubastaProductos(subastaProductosList);\n      }\n    });\n  };\n\n  useEffect(function () {\n    if (subastaProductos) {\n      var findNextProducto = false;\n      subastaProductos.forEach(function (element) {\n        if (element.status === \"en espera\" && !findNextProducto) {\n          setSubastaProductoActual(element);\n          setProductoEnSubastaActual(element.producto);\n          findNextProducto = true;\n        }\n      });\n    }\n  }, [subastaProductos]);\n\n  var handlerCreateSubastaOferta = function handlerCreateSubastaOferta(e) {\n    e.preventDefault();\n\n    if (!(valSubastaOferta !== \"\" && valSubastaOferta > productoEnSubastaActual.precio_inicial)) {\n      setErrorMessage('El valor de oferta de ser superior o igual al precio inicial.');\n      return;\n    }\n\n    var ofertaGanadora = 0;\n\n    if (winnerOferta === 0) {\n      ofertaGanadora = productoEnSubastaActual.precio_inicial;\n    } else {\n      ofertaGanadora = winnerOferta;\n    }\n\n    ;\n    console.log(winnerOferta, productoEnSubastaActual.precio_inicial, ofertaGanadora + productoEnSubastaActual.precio_aumento);\n\n    if (!(valSubastaOferta >= ofertaGanadora + productoEnSubastaActual.precio_aumento)) {\n      setErrorMessage('El valor de oferta de ser superior o igual al precio ganador + el precio de aumento del producto.');\n      return;\n    }\n\n    var subastaOfertaCreate = new proto.SubastaOfertaCreate();\n    subastaOfertaCreate.setUsersId(user.users_id);\n    subastaOfertaCreate.setOfertaPrecio(valSubastaOferta);\n    subastaOfertaCreate.setSubastasProductosId(1);\n    subastaService.addSubastaOferta(subastaOfertaCreate, {}, function (error, _) {\n      if (error !== null) console.log(error.code, error.message);\n    });\n    setValSubastaOferta(undefined);\n    document.getElementById('valSubastaOferta').value = '';\n  };\n\n  return /*#__PURE__*/React.createElement(Layout, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    sx: {\n      paddingTop: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 344,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 345,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 5,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 346,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 5,\n    align: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 347,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    style: {\n      paddingBottom: '20px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"h1\",\n    fontSize: 40,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 33\n    }\n  }, subasta.subasta), /*#__PURE__*/React.createElement(Typography, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 33\n    }\n  }, \"Subastando - \", productoEnSubastaActual.producto, \" / \", subastaProductoActual.status, \" \", /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 353,\n      columnNumber: 118\n    }\n  }), \"Unidades - \", productoEnSubastaActual.stock, \" \", /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 80\n    }\n  }))), startCount && /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 359,\n      columnNumber: 44\n    }\n  }, winnerOferta > 0 && /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    paddingY: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(Alert, {\n    variant: \"outlined\",\n    severity: \"success\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 362,\n      columnNumber: 37\n    }\n  }, \"Oferta ganadora: \", winnerOferta)), error_message !== '' && /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    paddingBottom: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 369,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(Alert, {\n    severity: \"error\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 37\n    }\n  }, error_message)), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 8,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    inputProps: {\n      inputMode: 'numeric',\n      pattern: '[0-9]*'\n    },\n    style: {\n      height: '38px'\n    },\n    id: \"valSubastaOferta\",\n    onChange: function onChange(e) {\n      return setValSubastaOferta(e.target.value);\n    },\n    fullWidth: true,\n    label: \"Ofertar\",\n    variant: \"outlined\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 374,\n      columnNumber: 37\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: handlerCreateSubastaOferta,\n    fullWidth: true,\n    variant: \"outlined\",\n    size: \"large\"\n    /* style={{ paddingTop: '13px', paddingBottom: '13px' }} */\n    ,\n    style: {\n      padding: '14px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 37\n    }\n  }, \"Ofertar\"))), startCount && /*#__PURE__*/React.createElement(DataGridSubastaOfertas, {\n    rows: rows,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 395,\n      columnNumber: 44\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 7,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 399,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    style: {\n      paddingBottom: '40px',\n      paddingTop: '20px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    align: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 402,\n      columnNumber: 33\n    }\n  }, fecha), startCount && /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      width: '100%'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    padding: 2,\n    sx: {\n      borderRadius: 1,\n      backgroundColor: '#e6e6e6',\n      margin: 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 37\n    }\n  }, minute), /*#__PURE__*/React.createElement(Box, {\n    padding: 2,\n    sx: {\n      borderRadius: 1,\n      backgroundColor: '#e6e6e6',\n      margin: 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 37\n    }\n  }, second))), /*#__PURE__*/React.createElement(StepperVertical, {\n    steps: subastaProductos,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 419,\n      columnNumber: 29\n    }\n  }))))));\n}","map":{"version":3,"sources":["/home/juan/node_projects/js-client-grpc-web/src/Subastas/JoinSubasta.js"],"names":["React","useEffect","useState","useParams","Alert","Box","Button","Container","Grid","TextField","Typography","proto","DataGridSubastaOfertas","Layout","useToken","jwt_decode","StepperVertical","moment","subastaService","SubastaServiceClient","JoinSubasta","id","subasta","setSubasta","subastaProductos","setSubastaProductos","productoEnSubastaActual","setProductoEnSubastaActual","subastaProductoActual","setSubastaProductoActual","winnerOferta","setWinnerOferta","error_message","setErrorMessage","rows","setRows","undefined","valSubastaOferta","setValSubastaOferta","user","setUser","token","fecha","setFecha","second","setSecond","minute","setMinute","startCount","setStartCount","subastaFinalizada","setSubastaFinalizada","inicio","setInicio","fin","setFin","getSubasta","getUser","getTest","console","log","getSubastaProductos","fecha1","fecha2","duracion","interval","setInterval","_fecha","actual","tiempo_maximo","add","diferencia_tiempo_maximo","diff","diferencia_t_m_seconds","clearInterval","segundos","min","diferencia","dif_seconds","request","SubastaProductoId","setId","productos_id","setProductoEnSubasta","error","_","code","message","pSubastaInicio","pSubastaFin","producto","token_decoded","users_id","name","photo","profile_photo_path","getSubastaOfertas","stream","on","response","record","oferta","getOfertaPrecio","SubastaId","metadata","err","getId","getFecha","activo","getActivo","getDuracion","created_at","getCreatedAt","updated_at","getUpdatedAt","subastaProductosList","getSubastasProductosList","map","subastaProducto","array","descripcion","stock","precio_inicial","precio_aumento","precio_subasta","cliente","cliente_id","cuit","direccion","ciudad","iva","oferta_final","subastas_ofertas_id_winner","status","findNextProducto","forEach","element","handlerCreateSubastaOferta","e","preventDefault","ofertaGanadora","subastaOfertaCreate","SubastaOfertaCreate","setUsersId","setOfertaPrecio","setSubastasProductosId","addSubastaOferta","document","getElementById","value","paddingTop","paddingBottom","inputMode","pattern","height","target","padding","display","justifyContent","width","borderRadius","backgroundColor","margin"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { useParams } from 'react-router-dom'\nimport { Alert, Box, Button, Container, Grid, TextField, Typography } from '@mui/material';\nimport proto from '../pb/proto_grpc_web_pb';\nimport DataGridSubastaOfertas from '../components/DataGridTable';\nimport Layout from '../components/Layout/Layout';\nimport useToken from '../App/useToken';\nimport jwt_decode from 'jwt-decode';\nimport StepperVertical from '../components/StepperVertical';\nimport moment from 'moment';\n\n\n/** My Client gRPC - to Golang gRPC Server */\nvar subastaService = new proto.SubastaServiceClient('http://0.0.0.0:8000');\n\n\nexport default function JoinSubasta(){\n    const { id } = useParams();\n\n    /** Info Subasta */\n    const [subasta, setSubasta] = useState({});\n\n    /** Lista de productos en subasta */\n    const [subastaProductos, setSubastaProductos] = useState([]);\n\n    /** Producto actual en Subasta */\n    const [productoEnSubastaActual, setProductoEnSubastaActual] = useState(0);\n\n    /** Producto subasta */\n    const [subastaProductoActual, setSubastaProductoActual] = useState(0);\n    \n    /** Set Precio de oferta */\n    const [winnerOferta, setWinnerOferta] = useState([]);\n\n    /** Error form add oferta */\n    const [error_message, setErrorMessage] = useState('')\n    const [rows, setRows] = useState([]);\n    const [valSubastaOferta, setValSubastaOferta] = useState(undefined);\n    const [user, setUser] = useState({});\n    const { token } = useToken();\n    const [fecha, setFecha] = useState(\"\");\n    const [second, setSecond] = useState(\"00\");\n    const [minute, setMinute] = useState(\"00\");\n    const [startCount, setStartCount] = useState(false);\n    const [subastaFinalizada, setSubastaFinalizada] = useState(false);\n\n    /** Controles de tiempo */\n    const [inicio, setInicio] = useState();\n    const [fin, setFin] = useState();\n\n    useEffect(() => {\n        /** The Subasta */\n        getSubasta();\n\n        \n\n        /** Ofertas */\n        //getSubastaOfertas();\n\n        /** Set Data for User */\n        getUser();\n\n\n        getTest();\n    }, [])\n\n    useEffect(() => {\n        /** Products from subasta */\n        if(subasta.id){\n            console.log(\"cargar\", subasta.id)\n            getSubastaProductos();\n        }\n\n    }, [subasta.id])\n\n    const getTest = () => {\n        var fecha1 = moment(\"2022-04-07 09:30:00\");\n        var fecha2 = moment(\"2022-04-07 09:30:00\");\n\n        /*   \n        console.log(\"fecha1: \", fecha1);\n        console.log(\"fecha2: \", fecha2);\n\n        console.log(fecha2.diff(fecha1, 'minutes'), \"diferencia en minutos\");\n        \n\n        console.log(\"Se agrego 10 minutos a la fecha 2\");\n        fecha2.add(10, 'minute');\n        console.log(fecha2.diff(fecha1, 'minutes'), \"diferencia en minutos\");\n\n        */\n    }\n\n    /** Hacer generica la funcion para reutilizarla en el proximo producto */\n    useEffect(() => {\n\n        if(subasta.fecha && subasta.duracion){\n            let interval = setInterval(() => {\n                let _fecha = moment(subasta.fecha)\n                let actual = moment();\n                let tiempo_maximo = moment(subasta.fecha);\n                tiempo_maximo.add(subasta.duracion, 'minute');\n\n                let diferencia_tiempo_maximo = actual.diff(tiempo_maximo, 'minute');\n                let diferencia_t_m_seconds = actual.diff(tiempo_maximo, 'second');\n                \n                if(actual > tiempo_maximo){ // Llego tarde.\n                    let fecha = \"Ya ha finalizado este fragmento de subasta . . . \"\n                    setFecha(fecha);\n                    setStartCount(false);\n                    clearInterval(interval);\n                    return ;\n                }\n\n                if(diferencia_tiempo_maximo == 0 && diferencia_t_m_seconds == 0){ // quedo no tocar\n                    let fecha = \"El tiempo de subasta de este producto ha terminado . . . \"\n                    setFecha(fecha);\n                    setStartCount(false);\n                    clearInterval(interval);\n                    return ;\n                }\n\n                console.log(\"mostrar restante: minutos \", diferencia_tiempo_maximo, \" segundos \", diferencia_t_m_seconds);\n                if(diferencia_tiempo_maximo < 0 && diferencia_t_m_seconds < 0){\n                    let segundos = 0;\n                    if((diferencia_tiempo_maximo*-1) !== 0){\n                        segundos = ((diferencia_t_m_seconds*-1) - ((diferencia_tiempo_maximo*-1))*60);\n                    }else{\n                        segundos = (diferencia_t_m_seconds*-1);\n                    }\n                    let min = diferencia_tiempo_maximo*-1;\n                    setMinute(min);\n                    setSecond(segundos);\n                    let fecha = \"Restan \"+ min + \" minutos \"+ segundos + \" segundos.\";\n                    setFecha(fecha)\n                }\n\n                var diferencia = _fecha.diff(actual, 'minute');\n                var dif_seconds = _fecha.diff(actual, 'second');\n                console.log(\"loop diferencia minutos: \", diferencia, \" segundos: \", dif_seconds);\n                console.log(\"estatus \", subastaProductoActual);\n                if (diferencia == 0 && dif_seconds == 0){\n                    console.log(\"hola\", diferencia)\n                    let request = new proto.SubastaProductoId();\n\n                    request.setId(productoEnSubastaActual.productos_id);\n                    subastaService.setProductoEnSubasta(request, {}, (error, _) => {\n                        if(error){\n                            setErrorMessage(error.code+\" \"+error.message);\n                            setStartCount(false);\n\n                            return ;\n                        }\n\n                        \n                        /* subastaProductoActual.status = \"en subasta\";\n                        setSubastaProductoActual(subastaProductoActual); */\n                        setStartCount(true);\n                    })\n\n                    let fecha = \"Ha comenzado la subasta . . .\";\n                    setFecha(fecha);\n                    return ;\n                }\n\n                if(diferencia >= 0 && dif_seconds > 0){ // quedo ! no tocar\n                    let fecha = \"ComenzarÃ¡ en \"+ diferencia + \" minutos \" + (dif_seconds-(diferencia*60)) + \" segundos.\";\n                    setFecha(fecha)\n                }\n            }, 1000)\n        }\n    }, [subasta.fecha, subasta.duracion]) // Se ejecuta cuando la variable fecha esta lista\n\n\n    useEffect(() => {\n         if(startCount){\n            \n            let pSubastaInicio = moment(subasta.fecha);\n            let pSubastaFin = moment(subasta.fecha)\n            pSubastaFin.add(subasta.duracion, 'minute');\n\n            let interval = setInterval(() => {\n                console.log(\"_____ itera ??? \")\n                let diferencia = pSubastaFin.diff(pSubastaInicio, 'minutes');\n                if(diferencia === 0){\n                    setStartCount(false);\n                    setFecha(\"Subasta producto \"+productoEnSubastaActual.producto+ \" ha finalizado\");\n    \n                    clearInterval(interval)\n                }\n            }, 1000)\n        }\n\n    }, [startCount])\n\n    const getUser = () => {\n        var token_decoded = jwt_decode(token);\n        let user = {\n            users_id: token_decoded.users_id,\n            name: token_decoded.name,\n            photo: token_decoded.profile_photo_path,\n        }\n        setUser(user);\n    }\n\n    const getSubastaOfertas = () => {\n        console.log(\"Obteniendo subastas ofertas -- from server golang\")\n    \n        let request = new proto.SubastaProductoId();\n        request.setId(productoEnSubastaActual.id)\n        var stream = subastaService.getSubastaOfertas(request, {});\n\n        stream.on('data', function(response){\n            let record = {\n                user: response.getUser(),\n                oferta: response.getOfertaPrecio()\n            };   \n\n            if(record.oferta > winnerOferta){\n                setWinnerOferta(record.oferta)\n            }\n\n            setRows((rows) => [...rows, record])\n        })\n\n    };\n\n    function getSubasta() {\n        var request = new proto.SubastaId();\n        request.setId(id)\n        var metadata = {};\n    \n        subastaService.getSubasta(request, metadata, (err, response) => {\n            if (err) {\n                console.log(err.code, err.message);\n            } else {\n                let subasta = {\n                    id: response.getId(),\n                    subasta: response.getSubasta(),\n                    fecha: response.getFecha(),\n                    activo: response.getActivo(),\n                    duracion: response.getDuracion(),\n                    created_at: response.getCreatedAt(),\n                    updated_at: response.getUpdatedAt()\n                }\n                setSubasta(subasta);\n            }\n        });\n    }\n\n    const getSubastaProductos = () => {\n        var request = new proto.SubastaId()\n        let id = subasta.id;\n        request.setId(id)\n        var metadata = {}\n\n        subastaService.getSubastaProductos(request, metadata, (err, response) => {\n            if(err){\n                console.log(err.code, err.message)\n            }else{\n                let subastaProductosList = response.getSubastasProductosList();\n                subastaProductosList = subastaProductosList\n                    .map((subastaProducto) => {\n                        return {\n                            id: subastaProducto.array[0],\n                            producto: {\n                                productos_id: subastaProducto.array[1][0],\n                                producto: subastaProducto.array[1][1],\n                                descripcion: subastaProducto.array[1][2],\n                                stock: subastaProducto.array[1][3],\n                                precio_inicial: subastaProducto.array[1][4],\n                                precio_aumento: subastaProducto.array[1][5],\n                                precio_subasta: subastaProducto.array[1][6],\n                                cliente: {\n                                    cliente_id: subastaProducto.array[1][7][0],\n                                    cliente: subastaProducto.array[1][7][1],\n                                    cuit: subastaProducto.array[1][7][2],\n                                    direccion: subastaProducto.array[1][7][3],\n                                    ciudad: subastaProducto.array[1][7][4],\n                                    iva: subastaProducto.array[1][7][5],\n                                },\n                            },\n                            activo: subastaProducto.array[2],\n                            oferta_final: subastaProducto.array[3],\n                            subastas_ofertas_id_winner: subastaProducto.array[4],\n                            status: subastaProducto.array[5]\n                        }\n                    })\n                setSubastaProductos(subastaProductosList);\n            }\n        });\n    }\n\n\n    useEffect(()=>{\n        if(subastaProductos){\n            let findNextProducto = false;\n            subastaProductos.forEach(element => {\n                if(element.status === \"en espera\" && !findNextProducto){\n                    setSubastaProductoActual(element)\n                    setProductoEnSubastaActual(element.producto)\n                    findNextProducto = true;\n                }\n            });\n        }\n    }, [subastaProductos])\n\n\n    const handlerCreateSubastaOferta = (e) => {\n        e.preventDefault();\n\n        if(!(valSubastaOferta !== \"\" && valSubastaOferta > productoEnSubastaActual.precio_inicial)) {\n            setErrorMessage('El valor de oferta de ser superior o igual al precio inicial.');\n            return ;\n        }\n\n        var ofertaGanadora = 0;\n        if(winnerOferta === 0) {\n            ofertaGanadora = productoEnSubastaActual.precio_inicial} \n        else {\n            ofertaGanadora = winnerOferta;\n        };\n        console.log(winnerOferta, productoEnSubastaActual.precio_inicial, ofertaGanadora+productoEnSubastaActual.precio_aumento)\n        if(!(valSubastaOferta >= (ofertaGanadora+productoEnSubastaActual.precio_aumento))){\n            setErrorMessage('El valor de oferta de ser superior o igual al precio ganador + el precio de aumento del producto.');\n            return ;\n        } \n\n        let subastaOfertaCreate = new proto.SubastaOfertaCreate();\n        subastaOfertaCreate.setUsersId(user.users_id);\n        subastaOfertaCreate.setOfertaPrecio(valSubastaOferta);\n        subastaOfertaCreate.setSubastasProductosId(1);\n\n        subastaService.addSubastaOferta(subastaOfertaCreate, {}, (error, _) => {\n            if(error !== null) console.log(error.code, error.message);\n        });\n\n        setValSubastaOferta(undefined)\n        document.getElementById('valSubastaOferta').value = '';\n    }\n\n    return (\n        <Layout>\n            <Box sx={{ paddingTop: 8 }}>\n                <Container>\n                    <Grid container spacing={5}>\n                        <Grid item xs={5} align=\"left\">      \n                            <Box style={{ paddingBottom: '20px' }}>\n                                <Typography variant=\"h1\" fontSize={40}>\n                                    {subasta.subasta}\n                                </Typography>        \n                                <Typography>\n                                    Subastando - {productoEnSubastaActual.producto} / {subastaProductoActual.status} <br></br>  \n                                    Unidades - {productoEnSubastaActual.stock} <br></br>\n                                </Typography>    \n                            </Box>\n\n\n                            {startCount && <Grid container>   \n                                {winnerOferta > 0 &&\n                                <Grid item xs={12} paddingY={4}>\n                                    <Alert  variant=\"outlined\" severity=\"success\">\n                                        Oferta ganadora: { winnerOferta }\n                                    </Alert>\n                                </Grid>}\n\n\n                                {error_message !== '' &&\n                                <Grid item xs={12} paddingBottom={4}> \n                                    <Alert severity=\"error\">{ error_message }</Alert>  \n                                </Grid>}\n\n                                <Grid item xs={8}>\n                                    <TextField \n                                        inputProps={{ inputMode: 'numeric', pattern: '[0-9]*'  }}\n                                        style={{ height:'38px' }}\n                                        id=\"valSubastaOferta\" \n                                        onChange={(e) => setValSubastaOferta(e.target.value)} \n                                        fullWidth \n                                        label=\"Ofertar\" \n                                        variant=\"outlined\" \n                                    />\n                                </Grid>\n                                <Grid item xs={4}>\n                                    <Button onClick={handlerCreateSubastaOferta} fullWidth variant=\"outlined\" size=\"large\" \n                                        /* style={{ paddingTop: '13px', paddingBottom: '13px' }} */\n                                        style={{ padding:'14px' }}\n                                    >\n                                        Ofertar\n                                    </Button>\n                                </Grid>\n                            </Grid>}\n\n\n                            {startCount && <DataGridSubastaOfertas rows={rows} />}\n                            \n                        </Grid>\n\n                        <Grid item xs={7}>  \n                                \n                            <Box style={{ paddingBottom: '40px', paddingTop: '20px' }}>\n                                <Typography align='center'>\n                                    {fecha} \n                                </Typography>\n                                \n                                {startCount && \n                                <div style={{ display:'flex', justifyContent:'center', width:'100%' }}>\n                                    <Box padding={2} sx={{ borderRadius: 1, backgroundColor: '#e6e6e6', margin: 1 }}>\n                                        {minute}\n                                    </Box>\n                                \n                                    <Box padding={2} sx={{ borderRadius: 1, backgroundColor: '#e6e6e6', margin: 1 }}>\n                                        {second}\n                                    </Box>\n                                </div>}\n\n                            </Box>\n\n                            <StepperVertical steps={subastaProductos}/>\n                            {/*  <StepperListSubastaProductos subastaProductos={subastaProductos}/> */}\n                        </Grid>\n                    </Grid>\n\n                         \n                </Container>\n            </Box>\n        </Layout>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}